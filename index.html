<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Happyyy Birthdayyyy Yuviiiii üéâ</title>
<meta name="theme-color" content="#ff5aa5" />
<style>
  :root{ --bg1:#070a18; --bg2:#111633; }
  *{ box-sizing:border-box; }
  html,body{ height:100%; }
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    color:#fff;
    background:
      radial-gradient(1200px 800px at 20% 10%, rgba(255,90,165,.18), transparent 55%),
      radial-gradient(1000px 700px at 85% 25%, rgba(57,230,200,.12), transparent 60%),
      radial-gradient(900px 700px at 50% 120%, rgba(255,210,122,.10), transparent 55%),
      linear-gradient(180deg, var(--bg1), var(--bg2));
    overflow-x:hidden;
  }

  .wrap{ min-height:100%; display:flex; flex-direction:column; padding:18px 14px 26px; max-width:720px; margin:0 auto; gap:12px; }
  .hero{ text-align:center; padding-top:8px; z-index:5; position:relative; }
  .badge{
    width:58px;height:58px;border-radius:18px; display:grid; place-items:center; margin:0 auto 10px;
    background:rgba(255,255,255,.06); box-shadow:0 12px 38px rgba(0,0,0,.35); backdrop-filter:blur(10px);
    font-size:28px;
  }
  h1{ margin:0 0 6px; font-size:clamp(28px,6vw,44px); letter-spacing:.3px; text-shadow:0 10px 30px rgba(0,0,0,.35); }
  .sub{ margin:0; opacity:.9; }

  .scene{ flex:1; display:flex; align-items:center; justify-content:center; position:relative; }
  .stage{ width:100%; position:relative; padding: 8px 0 0; }

  #confettiCanvas{ position:absolute; inset:0; width:100%; height:100%; pointer-events:none; z-index:9; }

  .photo-frame{
    width:min(640px,96vw); margin:0 auto; position:relative; border-radius:24px; overflow:hidden;
    box-shadow:0 34px 60px rgba(0,0,0,.35); z-index:3; background:rgba(255,255,255,.06);
  }
  .cake-photo{
    width:100%; height:min(560px,72vh); object-fit:cover;
    object-position:50% 26%; /* hides stand more */
    display:block;
    animation:cakeFloat 8s ease-in-out infinite;
    transform-origin:50% 45%;
    filter:contrast(1.02) saturate(1.04);
  }
  @keyframes cakeFloat{
    0%,100%{ transform:scale(1.02) translateY(0px); }
    50%{ transform:scale(1.05) translateY(-6px); }
  }

  .warm-glow{
    position:absolute; inset:0; pointer-events:none;
    background:
      radial-gradient(280px 160px at 50% 22%, rgba(255,200,100,.18), rgba(255,200,100,0) 70%),
      radial-gradient(360px 220px at 50% 45%, rgba(255,140,80,.10), rgba(255,140,80,0) 70%);
    mix-blend-mode:screen; opacity:.9; z-index:2;
  }

  .sparkles{ position:absolute; inset:0; pointer-events:none; z-index:8; }
  .sparkles::before{
    content:""; position:absolute; inset:-10%;
    background:
      radial-gradient(circle at 22% 20%, rgba(255,255,255,.9) 0 2px, transparent 3px),
      radial-gradient(circle at 68% 18%, rgba(255,255,255,.8) 0 1.5px, transparent 3px),
      radial-gradient(circle at 80% 32%, rgba(255,255,255,.75) 0 1.5px, transparent 3px),
      radial-gradient(circle at 28% 36%, rgba(255,255,255,.75) 0 1.5px, transparent 3px),
      radial-gradient(circle at 44% 26%, rgba(255,255,255,.8) 0 2px, transparent 3px),
      radial-gradient(circle at 58% 34%, rgba(255,255,255,.7) 0 1.5px, transparent 3px);
    opacity:.55; animation:twinkle 3.8s ease-in-out infinite; filter:blur(.1px);
  }
  @keyframes twinkle{ 0%,100%{opacity:.25; transform:translateY(0)} 50%{opacity:.65; transform:translateY(-6px)} }

  .candles{ position:absolute; inset:0; pointer-events:none; z-index:7; }
  .candle{
    position:absolute; width:18px; height:78px; border:none; border-radius:10px;
    cursor:pointer; touch-action:manipulation; pointer-events:auto;
    transform:translate(-50%,-100%);
    box-shadow:0 16px 24px rgba(0,0,0,.28);
    background:
      radial-gradient(12px 22px at 30% 18%, rgba(255,255,255,.38), transparent 65%),
      radial-gradient(14px 28px at 70% 45%, rgba(0,0,0,.14), transparent 70%),
      linear-gradient(90deg, rgba(0,0,0,.14), rgba(255,255,255,.16) 35%, rgba(0,0,0,.10) 70%),
      repeating-linear-gradient(45deg, rgba(255,255,255,.92) 0 6px, rgba(57,230,200,.92) 6px 12px);
  }
  .candle.red{
    background:
      radial-gradient(12px 22px at 30% 18%, rgba(255,255,255,.38), transparent 65%),
      radial-gradient(14px 28px at 70% 45%, rgba(0,0,0,.14), transparent 70%),
      linear-gradient(90deg, rgba(0,0,0,.14), rgba(255,255,255,.16) 35%, rgba(0,0,0,.10) 70%),
      repeating-linear-gradient(45deg, rgba(255,255,255,.92) 0 6px, rgba(255,90,165,.92) 6px 12px);
  }
  .candle.yellow{
    background:
      radial-gradient(12px 22px at 30% 18%, rgba(255,255,255,.38), transparent 65%),
      radial-gradient(14px 28px at 70% 45%, rgba(0,0,0,.14), transparent 70%),
      linear-gradient(90deg, rgba(0,0,0,.14), rgba(255,255,255,.16) 35%, rgba(0,0,0,.10) 70%),
      repeating-linear-gradient(45deg, rgba(255,255,255,.92) 0 6px, rgba(255,214,68,.92) 6px 12px);
  }
  .candle.blue{
    background:
      radial-gradient(12px 22px at 30% 18%, rgba(255,255,255,.38), transparent 65%),
      radial-gradient(14px 28px at 70% 45%, rgba(0,0,0,.14), transparent 70%),
      linear-gradient(90deg, rgba(0,0,0,.14), rgba(255,255,255,.16) 35%, rgba(0,0,0,.10) 70%),
      repeating-linear-gradient(45deg, rgba(255,255,255,.92) 0 6px, rgba(74,162,255,.92) 6px 12px);
  }
  .candle.green{
    background:
      radial-gradient(12px 22px at 30% 18%, rgba(255,255,255,.38), transparent 65%),
      radial-gradient(14px 28px at 70% 45%, rgba(0,0,0,.14), transparent 70%),
      linear-gradient(90deg, rgba(0,0,0,.14), rgba(255,255,255,.16) 35%, rgba(0,0,0,.10) 70%),
      repeating-linear-gradient(45deg, rgba(255,255,255,.92) 0 6px, rgba(78,224,140,.92) 6px 12px);
  }
  .candle::before{
    content:""; position:absolute; top:-10px; left:50%; transform:translateX(-50%);
    width:3px; height:12px; background:linear-gradient(180deg, rgba(30,30,30,.9), rgba(10,10,10,.6)); border-radius:3px;
  }
  .candle.lit::after{
    content:""; position:absolute; top:-40px; left:50%; transform:translateX(-50%);
    width:18px; height:34px; border-radius:60%;
    background: radial-gradient(circle at 40% 28%, rgba(255,255,255,.95), rgba(255,247,179,.92) 35%, rgba(255,179,0,.95) 58%, rgba(255,106,0,.9) 78%, rgba(255,106,0,0) 80%);
    filter: drop-shadow(0 0 14px rgba(255,200,80,.75)) drop-shadow(0 0 26px rgba(255,140,30,.35));
    animation:flicker .11s infinite alternate;
  }
  @keyframes flicker{
    from{ transform:translateX(-50%) rotate(-4deg) scale(1); opacity:.92; }
    to{ transform:translateX(-50%) rotate(4deg) scale(1.07); opacity:1; }
  }

  .controls{ display:flex; gap:10px; justify-content:center; margin-top:12px; flex-wrap:wrap; z-index:10; position:relative; }
  button.primary, button.ghost{
    font-size:16px; padding:12px 14px; border-radius:14px;
    border:1px solid rgba(255,255,255,.14);
    cursor:pointer; touch-action:manipulation; color:white;
    background:rgba(255,255,255,.06);
    backdrop-filter:blur(10px);
    box-shadow:0 12px 24px rgba(0,0,0,.18);
  }
  button.primary{
    background:linear-gradient(180deg, rgba(255,90,165,.95), rgba(255,90,165,.70));
    border-color:rgba(255,90,165,.35);
    box-shadow:0 16px 30px rgba(255,90,165,.18);
  }

  .tiny{ font-size:12px; opacity:.75; text-align:center; margin-top:8px; z-index:10; position:relative; }
  .message{
    text-align:center; margin:14px auto 0; padding:14px 12px;
    border-radius:18px; background:rgba(57,230,200,.10);
    border:1px solid rgba(57,230,200,.22);
    backdrop-filter:blur(10px);
    max-width:620px; z-index:10; position:relative;
    box-shadow:0 16px 40px rgba(0,0,0,.25);
  }
  .footer{ text-align:center; opacity:.85; padding-top:8px; }
</style>
</head>

<body>
<main class="wrap">
  <header class="hero">
    <div class="badge">üéâ</div>
    <h1>Happyyy Birthdayyyy <span id="nm">Yuviiiii</span>!</h1>
    <p class="sub">Make a wish‚Ä¶ then blow out the candles üïØÔ∏è</p>
  </header>

  <section class="scene">
    <div class="stage">
      <canvas id="confettiCanvas"></canvas>

      <div class="photo-frame">
        <img id="cakeImg" class="cake-photo" alt="Cake" src="cake.jpg">
        <div class="warm-glow" aria-hidden="true"></div>
        <div class="candles" id="candlesLayer"></div>
        <div class="sparkles" aria-hidden="true"></div>
      </div>

      <div class="controls">
        <button id="micBtn" class="primary">Enable ‚ÄúBlow‚Äù üé§</button>
        <button id="relightBtn" class="ghost">Relight ‚ú®</button>
      </div>

      <p class="tiny" id="tiny"></p>

      <div class="message" id="message" hidden>
        <h2 style="margin:6px 0;">Woooo! üéÇ</h2>
        <p style="margin:0;">Wish granted. Have the best day ever!</p>
      </div>
    </div>
  </section>

  <footer class="footer">
    <small>With Love, From Flowerü´Ç‚ô•Ô∏è</small>
  </footer>
</main>

<script>
  document.getElementById("nm").textContent = "Yuviiiii";

  // Candle positions (% of image frame) ‚Äî tuned for your cake photo style.
  // If you want them to sit perfectly on YOUR crop, tell me and I‚Äôll tweak.
  const CANDLES = [
    { x: 26, y: 33, cls: "red"    },
    { x: 34, y: 30, cls: "blue"   },
    { x: 44, y: 28, cls: "green"  },
    { x: 60, y: 28, cls: "yellow" },
    { x: 70, y: 30, cls: "blue"   },
    { x: 78, y: 33, cls: "red"    },
    { x: 84, y: 35, cls: "yellow" }
  ];

  const candlesLayer = document.getElementById("candlesLayer");
  const candles = [];
  CANDLES.forEach((p, i) => {
    const b = document.createElement("button");
    b.className = `candle lit ${p.cls || ""}`.trim();
    b.style.left = p.x + "%";
    b.style.top  = p.y + "%";
    b.setAttribute("aria-label", "Candle " + (i+1));
    b.addEventListener("click", () => { b.classList.toggle("lit"); setMessageIfDone(); }, { passive:true });
    candlesLayer.appendChild(b);
    candles.push(b);
  });

  const micBtn = document.getElementById("micBtn");
  const relightBtn = document.getElementById("relightBtn");
  const message = document.getElementById("message");
  const tiny = document.getElementById("tiny");

  function litCount(){ return candles.filter(c => c.classList.contains("lit")).length; }
  function setMessageIfDone(){ if (litCount() === 0){ message.hidden = false; burstConfetti(); } }
  relightBtn.addEventListener("click", () => { candles.forEach(c=>c.classList.add("lit")); message.hidden = true; });

  // Confetti
  const confettiCanvas = document.getElementById("confettiCanvas");
  const ctx = confettiCanvas.getContext("2d", { alpha:true });
  let confetti = [], confettiRaf=null;

  function resizeConfetti(){
    const dpr = window.devicePixelRatio || 1;
    confettiCanvas.width = Math.floor(confettiCanvas.clientWidth * dpr);
    confettiCanvas.height = Math.floor(confettiCanvas.clientHeight * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  new ResizeObserver(resizeConfetti).observe(confettiCanvas);
  window.addEventListener("resize", resizeConfetti, { passive:true });
  resizeConfetti();

  const rand = (a,b)=>Math.random()*(b-a)+a;

  function burstConfetti(){
    const w = confettiCanvas.clientWidth, h = confettiCanvas.clientHeight;
    const ox = w*0.5, oy = h*0.15;
    const colors = [
      ["#ff5aa5","#ff2f8c"], ["#39e6c8","#12cbb3"], ["#ffe9d6","#ffd4b3"],
      ["#ffd27a","#ff9f2e"], ["#b8a5ff","#5a46ff"], ["#7fd6ff","#2f89ff"], ["#ffffff","#dff7ff"]
    ];
    confetti = [];
    for(let i=0;i<220;i++){
      const c = colors[(Math.random()*colors.length)|0];
      confetti.push({
        x: ox + rand(-12,12), y: oy + rand(-10,10),
        vx: rand(-5.2,5.2), vy: rand(-7.2,-2.2), g: rand(0.10,0.18),
        w: rand(5,10), h: rand(3,7),
        rot: rand(0,Math.PI*2), vr: rand(-0.22,0.22),
        flip: rand(0,Math.PI*2), vflip: rand(0.12,0.28),
        c1: c[0], c2: c[1], life: rand(85,140),
        shape: Math.random()<0.22 ? "circle" : (Math.random()<0.35 ? "streamer" : "rect")
      });
    }
    if(confettiRaf) cancelAnimationFrame(confettiRaf);
    loopConfetti();
  }

  function drawPiece(p){
    const shade = Math.sin(p.flip);
    const color = shade > 0 ? p.c1 : p.c2;
    ctx.save();
    ctx.translate(p.x,p.y);
    ctx.rotate(p.rot);
    ctx.shadowColor="rgba(0,0,0,.25)";
    ctx.shadowBlur=6; ctx.shadowOffsetY=3;
    ctx.fillStyle=color;
    if(p.shape==="circle"){
      const r=(p.w+p.h)*0.22;
      ctx.beginPath(); ctx.arc(0,0,r,0,Math.PI*2); ctx.fill();
    } else {
      const ww=p.w*(0.6+Math.abs(shade)*0.6);
      const hh=p.shape==="streamer"?p.h*1.4:p.h;
      ctx.fillRect(-ww/2,-hh/2,ww,hh);
    }
    ctx.restore();
  }

  function loopConfetti(){
    const w = confettiCanvas.clientWidth, h = confettiCanvas.clientHeight;
    ctx.clearRect(0,0,w,h);
    for(const p of confetti){
      p.vy+=p.g; p.x+=p.vx; p.y+=p.vy; p.rot+=p.vr; p.flip+=p.vflip; p.life-=1;
      p.vx*=0.992; p.vy*=0.992;
      drawPiece(p);
    }
    confetti = confetti.filter(p => p.life>0 && p.y<h+60);
    if(confetti.length) confettiRaf=requestAnimationFrame(loopConfetti);
    else { ctx.clearRect(0,0,w,h); confettiRaf=null; }
  }

  // Mic blow-out (GitHub Pages is HTTPS so this works on most phones)
  let audioCtx, analyser, micStream, dataArray, rafId;
  let micEnabled=false, lastBlowAt=0;

  function stopMic(){
    if(rafId) cancelAnimationFrame(rafId);
    rafId=null;
    if(micStream){ micStream.getTracks().forEach(t=>t.stop()); micStream=null; }
    if(audioCtx){ audioCtx.close(); audioCtx=null; }
    micEnabled=false;
    micBtn.textContent='Enable ‚ÄúBlow‚Äù üé§';
    tiny.textContent='';
  }

  function blowOutRandom(n){
    for(let i=0;i<n;i++){
      const stillLit=candles.filter(c=>c.classList.contains("lit"));
      if(!stillLit.length) break;
      stillLit[(Math.random()*stillLit.length)|0].classList.remove("lit");
    }
    setMessageIfDone();
  }

  function micLoop(){
    analyser.getByteTimeDomainData(dataArray);
    let sum=0;
    for(let i=0;i<dataArray.length;i++){
      const v=(dataArray[i]-128)/128;
      sum+=v*v;
    }
    const rms=Math.sqrt(sum/dataArray.length);
    tiny.textContent = `Mic on ‚Ä¢ Blow: ${rms.toFixed(2)} ‚Ä¢ Candles: ${litCount()}`;

    const threshold=0.11;
    const now=Date.now();
    if(rms>threshold && (now-lastBlowAt)>450){
      lastBlowAt=now;
      const n = rms>0.22?3:(rms>0.16?2:1);
      blowOutRandom(n);
    }
    rafId=requestAnimationFrame(micLoop);
  }

  async function enableMic(){
    if(micEnabled){ stopMic(); return; }
    try{
      const stream = await navigator.mediaDevices.getUserMedia({
        audio:{ echoCancellation:true, noiseSuppression:true, autoGainControl:true }
      });
      micStream=stream;
      audioCtx=new (window.AudioContext||window.webkitAudioContext)();
      const source=audioCtx.createMediaStreamSource(stream);
      analyser=audioCtx.createAnalyser();
      analyser.fftSize=2048;
      dataArray=new Uint8Array(analyser.fftSize);
      source.connect(analyser);
      micEnabled=true;
      micBtn.textContent='Disable Mic ‚úã';
      micLoop();
    } catch(e){
      console.error(e);
      // tapping candles still works even if mic blocked
    }
  }

  micBtn.addEventListener("click", enableMic);
  document.addEventListener("visibilitychange", ()=>{ if(document.hidden && micEnabled) stopMic(); });
</script>
</body>
</html>
